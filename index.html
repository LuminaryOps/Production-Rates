<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Emmett's Rate Calculator with Deposit Handling</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
	@import url('https://fonts.googleapis.com/css2?family=Cormorant:wght@300;400;500;600;700&family=Italiana&family=Gilda+Display&family=DM+Sans:wght@300;400;500;600;700&display=swap');
    
    :root {
      --primary: #ff7b00;
      --primary-dark: #e66d00;
      --primary-light: #ffa149;
      --secondary: #2c3e50;
      --accent: #ff9f43;
      --success: #00c07f;
      --warning: #ffc107;
      --danger: #ff4757;
      --gray-50: #1a1a1a;
      --gray-100: #222222;
      --gray-200: #282828;
      --gray-300: #333333;
      --gray-400: #555555;
      --gray-500: #777777;
      --gray-600: #999999;
      --gray-700: #bbbbbb;
      --gray-800: #dddddd;
      --gray-900: #f5f5f5;
      --body-bg: #121212;
      --card-bg: #1e1e1e;
      --font-primary: 'DM Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      --font-display: 'Italiana', Georgia, serif;
      --font-heading: 'Gilda Display', Georgia, serif;
      --font-accent: 'Cormorant', Georgia, serif;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.25);
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.18);
      --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.15);
      --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.14);
      --border-radius: 12px;
      --transition: all 0.2s ease-in-out;
      --letter-spacing-display: 0.04em;
      --letter-spacing-body: 0.01em;
    }
    
    /* Base Styles */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: var(--font-primary);
      background-color: var(--body-bg);
      color: var(--gray-800);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      padding: 2rem 1rem;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 2rem;
      background-color: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-md);
      overflow: hidden;
    }
    
    @media (max-width: 768px) {
      body {
        padding: 1rem 0.5rem;
      }
      
      .container {
        padding: 1.5rem 1rem;
      }
    }
    
    /* Typography */
    h1, h2, h3, h4, h5, h6 {
      margin-bottom: 0.5em;
      font-weight: 600;
      line-height: 1.2;
      color: var(--gray-900);
    }
    
    h1 {
      font-size: 1.875rem;
      letter-spacing: -0.025em;
    }
    
    h2 {
      font-size: 1.25rem;
      margin-top: 1.5rem;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--gray-300);
      display: flex;
      align-items: center;
      position: relative;
    }
    
    h2 i {
      color: var(--primary);
      margin-right: 0.5rem;
    }
    
    h2:after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      width: 30%;
      height: 2px;
      background: linear-gradient(90deg, rgba(255,123,0,1) 0%, rgba(255,123,0,0) 100%);
    }
    
    p {
      margin-bottom: 1rem;
    }
    
    .subtitle {
      color: var(--gray-500);
      font-size: 0.875rem;
      margin-bottom: 2rem;
    }
    
    /* Header */
    .header {
      text-align: center;
      margin-bottom: 2rem;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid var(--gray-300);
      position: relative;
    }
    
    .header:after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 25%;
      width: 50%;
      height: 3px;
      background: linear-gradient(90deg, rgba(255,123,0,0) 0%, rgba(255,123,0,1) 50%, rgba(255,123,0,0) 100%);
    }
    
    .logo {
      max-width: 200px;
      height: auto;
      margin-bottom: 1rem;
    }
    
    /* Form Elements */
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    label {
      display: block;
      font-weight: 500;
      margin-bottom: 0.5rem;
      color: var(--gray-700);
      font-size: 0.875rem;
    }
    
    .row {
      display: flex;
      flex-wrap: wrap;
      margin: 0 -0.75rem 1rem;
    }
    
    .col {
      flex: 1;
      padding: 0 0.75rem;
      min-width: 200px;
    }
    
    @media (max-width: 768px) {
      .row {
        margin: 0;
      }
      
      .col {
        flex: 0 0 100%;
        padding: 0;
        margin-bottom: 1rem;
      }
    }
    
    input, select, textarea {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid var(--gray-300);
      border-radius: 8px;
      font-size: 1rem;
      font-family: var(--font-primary);
      color: var(--gray-800);
      background-color: var(--gray-100);
      transition: var(--transition);
      box-shadow: var(--shadow-sm);
      -webkit-appearance: none;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(255, 123, 0, 0.25);
    }
    
    select {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 1rem center;
      background-size: 1rem;
      padding-right: 2.5rem;
    }
    
    ::placeholder {
      color: var(--gray-400);
    }
    
    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.75rem 1.5rem;
      font-weight: 600;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
      box-shadow: var(--shadow-sm);
    }
    
    .btn-primary {
      background-color: var(--primary);
      color: white;
    }
    
    .btn-primary:hover {
      background-color: var(--primary-dark);
      box-shadow: var(--shadow);
    }
    
    .btn-primary:active {
      transform: translateY(1px);
    }
    
    .btn-outline {
      background-color: transparent;
      color: var(--primary);
      border: 1px solid var(--primary);
    }
    
    .btn-outline:hover {
      background-color: rgba(255, 123, 0, 0.15);
      color: var(--primary-light);
    }

    .btn-sm {
      padding: 0.4rem 0.8rem;
      font-size: 0.875rem;
    }
    
    .btn i {
      margin-right: 0.5rem;
    }
    
    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-top: 1.5rem;
    }
    
    @media (max-width: 768px) {
      .btn-group {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
      }
    }
    
    /* Tabs */
    .tabs {
      display: flex;
      margin-bottom: 2rem;
      border-bottom: 1px solid var(--gray-300);
    }
    
    .tab {
      padding: 0.75rem 1.5rem;
      font-weight: 500;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      color: var(--gray-500);
      transition: var(--transition);
    }
    
    .tab.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
      position: relative;
    }
    
    .tab.active:after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 100%;
      height: 2px;
      background-color: var(--primary);
      box-shadow: 0 0 8px 1px var(--primary);
    }
    
    .tab:hover:not(.active) {
      color: var(--gray-700);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* Result Sections */
    .result-section {
      margin-top: 2rem;
      display: none;
      animation: fadeIn 0.3s ease-in-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Glow effect for special elements */
    @keyframes glow {
      0% { box-shadow: 0 0 5px rgba(255, 123, 0, 0.5); }
      50% { box-shadow: 0 0 15px rgba(255, 123, 0, 0.8); }
      100% { box-shadow: 0 0 5px rgba(255, 123, 0, 0.5); }
    }
    
    .card {
      background-color: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--gray-300);
    }
    
    .card-header h3 {
      margin-bottom: 0;
      font-size: 1.25rem;
      color: var(--gray-800);
    }
    
    /* Tables */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1.5rem;
      font-size: 0.95rem;
    }
    
    th {
      text-align: left;
      padding: 0.75rem 1rem;
      font-weight: 500;
      color: var(--gray-700);
      background-color: var(--gray-200);
      border-bottom: 1px solid var(--gray-300);
    }
    
    td {
      padding: 0.75rem 1rem;
      border-bottom: 1px solid var(--gray-300);
      color: var(--gray-800);
    }
    
    tr:last-child td {
      border-bottom: none;
    }
    
    tr:hover td {
      background-color: var(--gray-200);
    }
    
    .total-row td {
      font-weight: 600;
      color: var(--primary-light);
      background-color: rgba(255, 123, 0, 0.15);
    }
    
    /* Pills/Badges */
    .badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      font-size: 0.75rem;
      font-weight: 500;
      border-radius: 9999px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    .badge-primary {
      background-color: rgba(255, 123, 0, 0.2);
      color: var(--primary-light);
    }
    
    .badge-success {
      background-color: rgba(0, 192, 127, 0.2);
      color: var(--success);
    }
    
    /* Notes */
    .note {
      padding: 1rem;
      border-radius: 8px;
      background-color: var(--gray-100);
      border-left: 3px solid var(--primary);
      margin-bottom: 1.5rem;
      font-size: 0.875rem;
      color: var(--gray-700);
    }
    
    .note-header {
      display: flex;
      align-items: center;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--gray-800);
    }
    
    .note-header i {
      color: var(--primary);
      margin-right: 0.5rem;
    }
    
    /* Alerts */
    .alert {
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: flex-start;
    }
    
    .alert i {
      margin-right: 0.75rem;
      font-size: 1.25rem;
      margin-top: 0.125rem;
    }
    
    .alert-danger {
      background-color: rgba(255, 59, 48, 0.1);
      color: var(--danger);
    }
    
    .alert-success {
      background-color: rgba(52, 199, 89, 0.1);
      color: var(--success);
    }
    
    /* Invoice Styles */
    .invoice-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }
    
    .invoice-header-left {
      display: flex;
      flex-direction: column;
    }
    
    .invoice-logo {
      height: 40px;
      width: auto;
      margin-bottom: 0.5rem;
    }
    
    .invoice-title {
      font-size: 2rem;
      font-weight: 700;
      color: var(--gray-900);
      letter-spacing: -0.025em;
    }
    
    .invoice-meta {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
      font-size: 0.875rem;
    }
    
    .invoice-meta-item {
      display: flex;
      flex-direction: column;
    }
    
    .invoice-meta-label {
      font-weight: 500;
      color: var(--gray-500);
      margin-bottom: 0.25rem;
    }
    
    .invoice-meta-value {
      font-weight: 600;
      color: var(--gray-800);
    }
    
    .invoice-summary {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 0.5rem;
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--gray-200);
    }
    
    .invoice-summary-row {
      display: flex;
      width: 100%;
      max-width: 300px;
      justify-content: space-between;
    }
    
    .invoice-summary-label {
      font-weight: 500;
      color: var(--gray-600);
    }
    
    .invoice-summary-value {
      font-weight: 600;
      color: var(--gray-800);
    }
    
    .invoice-total-row {
      font-size: 1.125rem;
      color: var(--gray-900);
      font-weight: 700;
      padding-top: 0.5rem;
      margin-top: 0.5rem;
      border-top: 2px solid var(--gray-200);
    }
    
    .invoice-footer {
      margin-top: 3rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--gray-200);
      text-align: center;
      font-size: 0.875rem;
      color: var(--gray-500);
    }
    
    /* Loading indicator */
    .loading {
      display: none;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }
    
    .loading-spinner {
      border: 3px solid rgba(0, 0, 0, 0.1);
      border-top: 3px solid var(--primary);
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
      margin-right: 0.75rem;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Custom Switches */
    .switch-container {
      display: flex;
      align-items: center;
      margin-top: 0.5rem;
    }
    
    .switch {
      position: relative;
      display: inline-block;
      width: 44px;
      height: 24px;
      margin-right: 0.75rem;
    }
    
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--gray-300);
      transition: .4s;
      border-radius: 34px;
    }
    
    .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    
    input:checked + .slider {
      background-color: var(--primary);
    }
    
    input:focus + .slider {
      box-shadow: 0 0 0 3px rgba(255, 123, 0, 0.25);
    }
    
    input:checked:focus + .slider {
      box-shadow: 0 0 0 3px rgba(255, 123, 0, 0.4);
    }
    
    input:checked + .slider:before {
      transform: translateX(20px);
    }
    
    .switch-label {
      font-size: 0.875rem;
      color: var(--gray-700);
    }
    
    /* Tooltips */
    .tooltip {
      position: relative;
      display: inline-block;
      margin-left: 0.5rem;
      color: var(--gray-400);
    }
    
    .tooltip .tooltip-text {
      visibility: hidden;
      width: 200px;
      background-color: var(--gray-800);
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 0.5rem;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 0.75rem;
      font-weight: normal;
    }
    
    .tooltip .tooltip-text::after {
      content: "";
      position: absolute;
      top: 100%;
      left: 50%;
      margin-left: -5px;
      border-width: 5px;
      border-style: solid;
      border-color: var(--gray-800) transparent transparent transparent;
    }
    
    .tooltip:hover .tooltip-text {
      visibility: visible;
      opacity: 1;
    }
    
    /* Dark Mode Toggle */
    .dark-mode-toggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: var(--gray-200);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow);
      cursor: pointer;
      transition: var(--transition);
      border: 1px solid var(--gray-300);
      color: var(--gray-700);
      z-index: 10;
    }
    
    .dark-mode-toggle:hover {
      color: var(--primary);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
      animation: glow 2s infinite;
    }

    /* Multiple specialty services styles */
    .specialty-item {
      display: flex;
      align-items: center;
      background-color: var(--gray-200);
      border-radius: 8px;
      padding: 0.75rem;
      margin-bottom: 1rem;
      border: 1px solid var(--gray-300);
    }

    .specialty-item-details {
      flex: 1;
    }

    .specialty-item-title {
      font-weight: 500;
      color: var(--gray-800);
      margin-bottom: 0.25rem;
    }

    .specialty-item-amount {
      font-size: 0.875rem;
      color: var(--gray-600);
    }

    .specialty-remove {
      margin-left: 1rem;
      color: var(--gray-600);
      cursor: pointer;
      transition: var(--transition);
    }

    .specialty-remove:hover {
      color: var(--danger);
    }

    .specialty-actions {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .add-specialty-form {
      display: flex;
      align-items: flex-end;
      flex-wrap: wrap;
      gap: 1rem;
      margin-top: 1rem;
      background-color: var(--gray-100);
      border-radius: 8px;
      padding: 1rem;
    }

    .service-input-group {
      flex: 2;
      min-width: 200px;
    }

    .amount-input-group {
      flex: 1;
      min-width: 120px;
    }

    .specialty-list {
      margin-top: 1rem;
    }

    .specialty-list-empty {
      text-align: center;
      padding: 1.5rem;
      background-color: var(--gray-100);
      border-radius: 8px;
      color: var(--gray-500);
      font-style: italic;
    }
    
    /* Light mode styles */
    body.light-mode {
      --primary: #0a84ff;
      --primary-dark: #0070e0;
      --primary-light: #d0e8ff;
      --secondary: #2c3e50;
      --accent: #5856d6;
      --success: #34c759;
      --warning: #ff9500;
      --danger: #ff3b30;
      --gray-50: #f9fafb;
      --gray-100: #f2f4f6;
      --gray-200: #e5e7eb;
      --gray-300: #d1d5db;
      --gray-400: #9ca3af;
      --gray-500: #6b7280;
      --gray-600: #4b5563;
      --gray-700: #374151;
      --gray-800: #1f2937;
      --gray-900: #111827;
      --body-bg: #f5f7fa;
      --card-bg: #ffffff;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    /* Print styles */
    @media print {
      body, body.light-mode {
        --body-bg: white;
        --card-bg: white;
        --gray-50: #f9fafb;
        --gray-100: #f2f4f6;
        --gray-200: #e5e7eb;
        --gray-300: #d1d5db;
        --gray-400: #9ca3af;
        --gray-500: #6b7280;
        --gray-600: #4b5563;
        --gray-700: #374151;
        --gray-800: #1f2937;
        --gray-900: #111827;
        background-color: white;
        color: black;
      }
      
      .container {
        box-shadow: none;
        padding: 0;
        max-width: 100%;
      }
      
      .tabs, .btn, .dark-mode-toggle {
        display: none !important;
      }
      
      .result-section {
        display: block !important;
      }
      
      .card {
        box-shadow: none;
        padding: 0;
      }
      
      a {
        text-decoration: none;
        color: black;
      }
      
      .col {
        min-width: 0;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header with Atom Animation -->
    <div class="header">
      <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 1rem;">
        <h1>Emmett's Production Rate Calculator</h1>
        <div style="width: 60px; height: 60px; margin-left: 15px;">
          <!-- Inline SVG for the atom animation -->
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200">
            <!-- Styling -->
            <defs>
              <radialGradient id="nucleusGradient" cx="50%" cy="50%" r="50%" fx="50%" fy="50%">
                <stop offset="0%" stop-color="#ff9f43" />
                <stop offset="100%" stop-color="#ff7b00" />
              </radialGradient>
              <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
                <feGaussianBlur stdDeviation="2" result="blur" />
                <feComposite in="SourceGraphic" in2="blur" operator="over" />
              </filter>
            </defs>

            <!-- Horizontal orbital ellipse -->
            <ellipse cx="100" cy="100" rx="70" ry="40" 
                    fill="none" stroke="#ff7b00" stroke-width="1" 
                    stroke-opacity="0.2" />
            
            <!-- Vertical orbital ellipse -->
            <ellipse cx="100" cy="100" rx="40" ry="70" 
                    fill="none" stroke="#ff7b00" stroke-width="1" 
                    stroke-opacity="0.2" />

            <!-- Electrons on horizontal orbit -->
            <circle cx="170" cy="100" r="4" fill="#ff7b00" filter="url(#glow)">
              <animateTransform attributeName="transform"
                              type="rotate"
                              from="0 100 100"
                              to="360 100 100"
                              dur="3s"
                              repeatCount="indefinite" />
            </circle>
            
            <circle cx="170" cy="100" r="4" fill="#ff7b00" filter="url(#glow)">
              <animateTransform attributeName="transform"
                              type="rotate"
                              from="180 100 100"
                              to="540 100 100"
                              dur="3s"
                              repeatCount="indefinite" />
            </circle>

            <!-- Electrons on vertical orbit -->
            <circle cx="100" cy="170" r="4" fill="#ff9f43" filter="url(#glow)">
              <animateTransform attributeName="transform"
                              type="rotate"
                              from="90 100 100"
                              to="450 100 100"
                              dur="5s"
                              repeatCount="indefinite" />
            </circle>
            
            <circle cx="100" cy="170" r="4" fill="#ff9f43" filter="url(#glow)">
              <animateTransform attributeName="transform"
                              type="rotate"
                              from="270 100 100"
                              to="630 100 100"
                              dur="5s"
                              repeatCount="indefinite" />
            </circle>

            <!-- Nucleus -->
            <circle cx="100" cy="100" r="10" fill="url(#nucleusGradient)" filter="url(#glow)">
              <animate attributeName="r" values="10;12;10" dur="2s" repeatCount="indefinite" />
            </circle>
          </svg>
        </div>
      </div>
      <p class="subtitle">(2025 Rates)</p>
    </div>
    
    <!-- Tabs -->
    <div class="tabs">
      <div class="tab active" data-tab="calculator">
        <i class="fas fa-calculator"></i> Calculator
      </div>
      <div class="tab" data-tab="ratecard">
        <i class="fas fa-file-invoice-dollar"></i> Rate Card
      </div>
    </div>
    
    <!-- Calculator Tab -->
    <div id="calculator" class="tab-content active">
      <!-- Form Section -->
      <div class="form-section">
        <h2><i class="fas fa-briefcase"></i> Service Details</h2>
        <div class="row">
          <div class="col">
            <div class="form-group">
              <label for="serviceType">Service Type</label>
              <select id="serviceType">
                <option value="single">Single Role Technician</option>
                <option value="multi">Multi-Role Technician</option>
                <option value="director">Technical Director</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <label for="durationType">Duration</label>
              <select id="durationType">
                <option value="full">Full Day (10 hrs)</option>
                <option value="half">Half Day (5 hrs)</option>
                <option value="2day">2-Day Package</option>
                <option value="3day">3-Day Package</option>
                <option value="5day">5-Day Package</option>
                <option value="custom">Custom Days</option>
              </select>
            </div>
          </div>
        </div>
        
        <div class="row" id="customDaysRow" style="display: none;">
          <div class="col">
            <div class="form-group">
              <label for="customDays">Number of Days</label>
              <input type="number" id="customDays" min="1" value="1">
            </div>
          </div>
        </div>
        
        <div class="row">
          <div class="col">
            <div class="form-group">
              <label for="additionalHours">Overtime Hours</label>
              <input type="number" id="additionalHours" min="0" value="0">
            </div>
          </div>
        </div>
        
        <h2><i class="fas fa-code-branch"></i> Specialty Services</h2>
        
        <!-- New Multiple Specialty Services Section -->
        <div class="specialty-list" id="specialtyList">
          <!-- List items will be added here dynamically -->
          <div class="specialty-list-empty" id="emptySpecialtyMessage">
            No specialty services added yet.
          </div>
        </div>
        
        <div class="add-specialty-form">
          <div class="service-input-group">
            <label for="specialtyServiceSelect">Add Specialty Service</label>
            <select id="specialtyServiceSelect">
              <option value="none">Select Service...</option>
              <option value="prep">Pre-Production Day</option>
              <option value="content">Content Development (hourly)</option>
              <option value="shader">Shader Development (hourly)</option>
              <option value="remote">Remote Consultation (hourly)</option>
              <option value="resolume">Resolume Laptop Rental - RTX 4070 (daily)</option>
              <option value="surface">Surface Pro Rental (daily)</option>
            </select>
          </div>
          <div class="amount-input-group">
            <label for="specialtyAmount">Hours/Days</label>
            <input type="number" id="specialtyAmount" min="1" value="1">
          </div>
          <button type="button" class="btn btn-outline btn-sm" id="addSpecialtyBtn">
            <i class="fas fa-plus"></i> Add Service
          </button>
        </div>
        
        <h2><i class="fas fa-user-friends"></i> Client & Discounts</h2>
        <div class="row">
          <div class="col">
            <div class="form-group">
              <label for="clientType">
                Client Type
                <div class="tooltip">
                  <i class="fas fa-info-circle"></i>
                  <span class="tooltip-text">Partner status is evaluated and reset monthly. Booking thresholds (5+ or 8+ days) must be met each month for discounts to apply.</span>
                </div>
              </label>
              <select id="clientType">
                <option value="regular">Regular</option>
                <option value="new">First-Time (10% off)</option>
                <option value="partner5">Partner 5-7 days/mo (10%)</option>
                <option value="partner8">Partner 8+ days/mo (15%)</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <label for="clientName">Client Name (optional)</label>
              <input type="text" id="clientName" placeholder="Enter client name">
            </div>
          </div>
        </div>
        
        <div class="note" style="margin-top: 1rem;">
          <div class="note-header">
            <i class="fas fa-sync-alt"></i> Partner Status Policy
          </div>
          <p>Partner status is evaluated at the beginning of each month. Monthly booking thresholds (5+ or 8+ days) must be met in the current month for applicable discounts to be applied.</p>
        </div>
        
        <div class="row">
          <div class="col">
            <div class="form-group">
              <label for="projectName">Project Name (optional)</label>
              <input type="text" id="projectName" placeholder="Enter project name">
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <label for="projectLocation">Location (optional)</label>
              <input type="text" id="projectLocation" placeholder="Enter project location">
            </div>
          </div>
        </div>
        
        <div class="switch-container">
          <label class="switch">
            <input type="checkbox" id="includeTravel">
            <span class="slider"></span>
          </label>
          <span class="switch-label">Include travel days (billed at full day rate)</span>
          <div class="tooltip">
            <i class="fas fa-info-circle"></i>
            <span class="tooltip-text">Travel days are billed at the full day rate regardless of actual hours traveled, as these days are exclusively dedicated to client projects.</span>
          </div>
        </div>
        
        <div id="travelDaysRow" style="display: none; margin-top: 1rem;">
          <div class="row">
            <div class="col">
              <div class="form-group">
                <label for="travelDays">Number of Travel Days</label>
                <input type="number" id="travelDays" min="0" value="0">
              </div>
            </div>
          </div>
        </div>
        
        <div class="btn-group">
          <button id="calculateBtn" class="btn btn-primary">
            <i class="fas fa-calculator"></i> Calculate Quote
          </button>
          <button id="resetBtn" class="btn btn-outline">
            <i class="fas fa-redo"></i> Reset Form
          </button>
        </div>
      </div>
      
      <!-- Loading Indicator -->
      <div class="loading" id="loadingIndicator">
        <div class="loading-spinner"></div>
        <span>Calculating...</span>
      </div>
      
      <!-- Quote Section -->
      <div id="quoteSection" class="result-section">
        <div class="card">
          <div class="card-header">
            <h3>
              <i class="fas fa-file-invoice"></i> 
              Quote Summary 
              <span class="badge badge-primary" id="quoteDate"></span>
            </h3>
            <div id="quoteInfo">
              <span id="quoteClientDisplay"></span>
              <span id="quoteProjectDisplay"></span>
            </div>
          </div>
          
          <table>
            <thead>
              <tr>
                <th>Service</th>
                <th>Details</th>
                <th>Rate</th>
                <th>Amount</th>
              </tr>
            </thead>
            <tbody id="quoteBody"></tbody>
          </table>
          
          <div class="note">
            <div class="note-header">
              <i class="fas fa-info-circle"></i> Important Notes
            </div>
            <div id="quoteNotes"></div>
          </div>
          
          <div class="btn-group">
            <button id="generateInvoice" class="btn btn-primary">
              <i class="fas fa-file-invoice-dollar"></i> Convert to Invoice
            </button>
            <button id="printQuote" class="btn btn-outline">
              <i class="fas fa-print"></i> Print Quote
            </button>
            <button id="saveQuotePdf" class="btn btn-outline">
              <i class="fas fa-file-pdf"></i> Save as PDF
            </button>
          </div>
        </div>
      </div>
      
      <!-- Invoice Section -->
      <div id="invoiceSection" class="result-section">
        <div class="card">
          <div class="invoice-header">
            <div class="invoice-header-left">
              <div class="invoice-title">INVOICE</div>
              <p id="invoiceDateTime"></p>
            </div>
            <div class="invoice-header-right">
              <span class="badge badge-primary" id="invoiceNumber"></span>
            </div>
          </div>
          
          <div class="invoice-meta">
            <div class="invoice-meta-item">
              <span class="invoice-meta-label">Client</span>
              <span class="invoice-meta-value" id="invoiceClient"></span>
            </div>
            <div class="invoice-meta-item">
              <span class="invoice-meta-label">Project</span>
              <span class="invoice-meta-value" id="invoiceProject"></span>
            </div>
            <div class="invoice-meta-item">
              <span class="invoice-meta-label">Date</span>
              <span class="invoice-meta-value" id="invoiceDate"></span>
            </div>
            <div class="invoice-meta-item">
              <span class="invoice-meta-label">Terms</span>
              <span class="invoice-meta-value" id="invoiceTerms">Due upon receipt</span>
            </div>
          </div>
          
          <table>
            <thead>
              <tr>
                <th>Service</th>
                <th>Details</th>
                <th>Rate</th>
                <th>Amount</th>
              </tr>
            </thead>
            <tbody id="invoiceBody"></tbody>
          </table>
          
          <!-- Deposit Handling Section -->
          <div class="invoice-summary">
            <div class="invoice-summary-row">
              <span class="invoice-summary-label">Subtotal:</span>
              <span class="invoice-summary-value" id="invoiceSubtotal"></span>
            </div>
            <div class="invoice-summary-row" id="depositRow">
              <span class="invoice-summary-label">Deposit Paid:</span>
              <span class="invoice-summary-value" id="invoiceDeposit"></span>
            </div>
            <div class="invoice-summary-row invoice-total-row">
              <span class="invoice-summary-label">Total Due:</span>
              <span class="invoice-summary-value" id="invoiceTotal"></span>
            </div>
          </div>
          
          <div class="invoice-footer">
            <p>Thank you for your business!</p>
            <p>For questions about this invoice, please contact: drewemmett123@gmail.com</p>
          </div>
          
          <div class="btn-group">
            <button id="printInvoice" class="btn btn-primary">
              <i class="fas fa-print"></i> Print Invoice
            </button>
            <button id="saveInvoicePdf" class="btn btn-outline">
              <i class="fas fa-file-pdf"></i> Save as PDF
            </button>
            <button id="backToQuote" class="btn btn-outline">
              <i class="fas fa-arrow-left"></i> Back to Quote
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Rate Card Tab -->
    <div id="ratecard" class="tab-content">
      <div class="card">
        <h2><i class="fas fa-dollar-sign"></i> Standard Day Rates</h2>
        <table>
          <thead>
            <tr>
              <th>Service Type</th>
              <th>Full Day (10 hrs)</th>
              <th>Half Day (5 hrs)</th>
              <th>Overtime (per hr)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Single Role Technician<br><small>LED, Media, Projection, Switching, etc.</small></td>
              <td>$500</td>
              <td>$290</td>
              <td>$100</td>
            </tr>
            <tr>
              <td>Multi-Role Technician<br><small>Any 2 technical roles</small></td>
              <td>$654</td>
              <td>$379</td>
              <td>$125</td>
            </tr>
            <tr>
              <td>Technical Director<br><small>Full show oversight + operation</small></td>
              <td>$955</td>
              <td>$550</td>
              <td>$140</td>
            </tr>
          </tbody>
        </table>
        
        <div class="note">
          <div class="note-header">
            <i class="fas fa-star"></i> Production Company Partners
          </div>
          <p>Companies booking 5+ days per month receive 10% off standard rates.<br>Regular clients (8+ days per month) receive 15% off.<br><strong>Note:</strong> Partner status is evaluated monthly and resets at the beginning of each month. Discounts apply only when monthly booking thresholds are met.</p>
        </div>
        
        <h2><i class="fas fa-cogs"></i> Specialty Services</h2>
        <table>
          <thead>
            <tr>
              <th>Service</th>
              <th>Rate</th>
              <th>Details</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Pre-Production / Prep Day</td>
              <td>$500</td>
              <td>Content prep, system setup, testing</td>
            </tr>
            <tr>
              <td>Content Development</td>
              <td>$90/hr</td>
              <td>Media creation, formatting, optimization</td>
            </tr>
            <tr>
              <td>Custom Shader Development</td>
              <td>$125/hr</td>
              <td>Real-time effects for media servers</td>
            </tr>
            <tr>
              <td>Remote Tech Consultation</td>
              <td>$100/hr</td>
              <td>System design, troubleshooting assistance</td>
            </tr>
            <tr>
              <td>Resolume Laptop Rental</td>
              <td>$75/day</td>
              <td>Nvidia RTX 4070, Resolume Arena preinstalled</td>
            </tr>
            <tr>
              <td>Surface Pro Rental</td>
              <td>$30/day</td>
              <td>Portable control surface for presentations</td>
            </tr>
          </tbody>
        </table>
        
        <h2><i class="fas fa-calendar-week"></i> Multi-Day Show Packages</h2>
        <div class="note">
          <div class="note-header">
            <i class="fas fa-info-circle"></i> Package Details
          </div>
          <p>All packages include on-site labor, show prep, and content workflow management.</p>
        </div>
        <table>
          <thead>
            <tr>
              <th>Duration</th>
              <th>Single Role</th>
              <th>Multi-Role</th>
              <th>Technical Director</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>2 Days</td>
              <td>$950 <small>(5% off)</small></td>
              <td>$1,243 <small>(5% off)</small></td>
              <td>$1,815 <small>(5% off)</small></td>
            </tr>
            <tr>
              <td>3 Days</td>
              <td>$1,350 <small>(10% off)</small></td>
              <td>$1,767 <small>(10% off)</small></td>
              <td>$2,579 <small>(10% off)</small></td>
            </tr>
            <tr>
              <td>5 Days</td>
              <td>$2,125 <small>(15% off)</small></td>
              <td>$2,780 <small>(15% off)</small></td>
              <td>$4,059 <small>(15% off)</small></td>
            </tr>
          </tbody>
        </table>
        
        <h2><i class="fas fa-file-contract"></i> Terms & Policies</h2>
        <ul style="list-style: none; padding-left: 0;">
          <li><i class="fas fa-check" style="color: var(--primary); margin-right: 0.5rem;"></i> First-time client discount of 10% available for initial bookings.</li>
          <li><i class="fas fa-check" style="color: var(--primary); margin-right: 0.5rem;"></i> <strong>Partner status</strong> is evaluated monthly and resets at the beginning of each month. Monthly booking thresholds must be met for discounts to apply.</li>
          <li><i class="fas fa-check" style="color: var(--primary); margin-right: 0.5rem;"></i> Travel and per diem billable for events requiring overnight stays.</li>
          <li><i class="fas fa-check" style="color: var(--primary); margin-right: 0.5rem;"></i> <strong>Travel days are billed at the full day rate</strong> regardless of actual hours traveled.</li>
          <li><i class="fas fa-check" style="color: var(--primary); margin-right: 0.5rem;"></i> Cancellation: 50% fee if within 7 days, 25% fee if within 14 days.</li>
          <li><i class="fas fa-check" style="color: var(--primary); margin-right: 0.5rem;"></i> All rates are for labor only. Equipment available through partner vendors.</li>
          <li><i class="fas fa-check" style="color: var(--primary); margin-right: 0.5rem;"></i> Guaranteed 10-hour workday. Hours beyond 10 billed at overtime rate.</li>
          <li><i class="fas fa-check" style="color: var(--primary); margin-right: 0.5rem;"></i> <strong>Deposits: 50% due upon booking for new clients, 25% for established clients.</strong></li>
        </ul>
      </div>
    </div>
  </div>
  
  <!-- Dark Mode Toggle -->
  <div class="dark-mode-toggle" id="darkModeToggle">
    <i class="fas fa-moon"></i>
  </div>
  
  <script>
    // Rate definitions
    const RATES = {
      single: { full: 500, half: 290, overtime: 100 },
      multi: { full: 654, half: 379, overtime: 125 },
      director: { full: 955, half: 550, overtime: 140 },
      specialty: { prep: 500, content: 90, shader: 125, remote: 100, resolume: 75, surface: 30 },
      packages: {
        single: { '2day': 950, '3day': 1350, '5day': 2125 },
        multi: { '2day': 1243, '3day': 1767, '5day': 2780 },
        director: { '2day': 1815, '3day': 2579, '5day': 4059 }
      },
      discounts: { new: 0.10, partner5: 0.10, partner8: 0.15 },
      packageDiscounts: { '2day': 0.05, '3day': 0.10, '5day': 0.15 },
      depositRates: { new: 0.50, regular: 0.25, partner5: 0.25, partner8: 0.25 } // Added deposit rates
    };
    
    // Element references
    // Form
    const serviceTypeEl = document.getElementById('serviceType');
    const durationTypeEl = document.getElementById('durationType');
    const customDaysRowEl = document.getElementById('customDaysRow');
    const customDaysEl = document.getElementById('customDays');
    const additionalHoursEl = document.getElementById('additionalHours');
    
    // Multiple specialty services
    const specialtyServiceSelectEl = document.getElementById('specialtyServiceSelect');
    const specialtyAmountEl = document.getElementById('specialtyAmount');
    const specialtyListEl = document.getElementById('specialtyList');
    const emptySpecialtyMessageEl = document.getElementById('emptySpecialtyMessage');
    const addSpecialtyBtnEl = document.getElementById('addSpecialtyBtn');
    
    const clientTypeEl = document.getElementById('clientType');
    const clientNameEl = document.getElementById('clientName');
    const projectNameEl = document.getElementById('projectName');
    const projectLocationEl = document.getElementById('projectLocation');
    const includeTravelEl = document.getElementById('includeTravel');
    const travelDaysRowEl = document.getElementById('travelDaysRow');
    const travelDaysEl = document.getElementById('travelDays');
    const calculateBtnEl = document.getElementById('calculateBtn');
    const resetBtnEl = document.getElementById('resetBtn');
    const loadingIndicatorEl = document.getElementById('loadingIndicator');
    
    // Quote
    const quoteSectionEl = document.getElementById('quoteSection');
    const quoteBodyEl = document.getElementById('quoteBody');
    const quoteNotesEl = document.getElementById('quoteNotes');
    const quoteDateEl = document.getElementById('quoteDate');
    const quoteClientDisplayEl = document.getElementById('quoteClientDisplay');
    const quoteProjectDisplayEl = document.getElementById('quoteProjectDisplay');
    const printQuoteEl = document.getElementById('printQuote');
    const saveQuotePdfEl = document.getElementById('saveQuotePdf');
    const generateInvoiceEl = document.getElementById('generateInvoice');
    
    // Invoice
    const invoiceSectionEl = document.getElementById('invoiceSection');
    const invoiceBodyEl = document.getElementById('invoiceBody');
    const invoiceNumberEl = document.getElementById('invoiceNumber');
    const invoiceDateEl = document.getElementById('invoiceDate');
    const invoiceDateTimeEl = document.getElementById('invoiceDateTime');
    const invoiceClientEl = document.getElementById('invoiceClient');
    const invoiceProjectEl = document.getElementById('invoiceProject');
    const invoiceSubtotalEl = document.getElementById('invoiceSubtotal');
    const invoiceDepositEl = document.getElementById('invoiceDeposit');
    const invoiceTotalEl = document.getElementById('invoiceTotal');
    const depositRowEl = document.getElementById('depositRow');
    const printInvoiceEl = document.getElementById('printInvoice');
    const saveInvoicePdfEl = document.getElementById('saveInvoicePdf');
    const backToQuoteEl = document.getElementById('backToQuote');
    
    // Dark mode
    const darkModeToggleEl = document.getElementById('darkModeToggle');
    
    // Global variables to store calculation results
    let quoteTotal = 0;
    let depositAmount = 0;
    let depositPercentage = 0;
    let specialtyServices = []; // Array to store multiple specialty services
    
    // Tab functionality
    const tabs = document.querySelectorAll('.tab');
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        // Remove active class from all tabs and tab contents
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        // Add active class to clicked tab and corresponding content
        tab.classList.add('active');
        const tabId = tab.getAttribute('data-tab');
        document.getElementById(tabId).classList.add('active');
      });
    });
    
    // Show custom days input
    durationTypeEl.addEventListener('change', () => {
      customDaysRowEl.style.display = durationTypeEl.value === 'custom' ? 'flex' : 'none';
    });
    
    // Set default amount based on service type
    specialtyServiceSelectEl.addEventListener('change', () => {
      if (specialtyServiceSelectEl.value === 'prep' || 
          specialtyServiceSelectEl.value === 'resolume' || 
          specialtyServiceSelectEl.value === 'surface') {
        specialtyAmountEl.value = 1;
        specialtyAmountEl.setAttribute('placeholder', 'Days');
      } else if (specialtyServiceSelectEl.value !== 'none') {
        specialtyAmountEl.value = 4;
        specialtyAmountEl.setAttribute('placeholder', 'Hours');
      } else {
        specialtyAmountEl.value = '';
        specialtyAmountEl.setAttribute('placeholder', 'Hours/Days');
      }
    });
    
    // Add specialty service
    addSpecialtyBtnEl.addEventListener('click', addSpecialtyService);
    
    function addSpecialtyService() {
      const serviceType = specialtyServiceSelectEl.value;
      const amount = parseInt(specialtyAmountEl.value) || 0;
      
      if (serviceType === 'none' || amount <= 0) {
        alert('Please select a service and enter a valid amount.');
        return;
      }
      
      // Check if this service is already added
      const existingService = specialtyServices.find(s => s.type === serviceType);
      if (existingService) {
        if (confirm(`${getSpecName(serviceType)} is already added. Do you want to update the amount instead?`)) {
          existingService.amount = amount;
          refreshSpecialtyList();
        }
        return;
      }
      
      // Add service to array
      specialtyServices.push({
        id: Date.now(), // unique ID for removal
        type: serviceType,
        amount: amount
      });
      
      // Reset form
      specialtyServiceSelectEl.value = 'none';
      specialtyAmountEl.value = '';
      
      // Refresh the list
      refreshSpecialtyList();
    }
    
    function refreshSpecialtyList() {
      // Clear current list
      while (specialtyListEl.firstChild) {
        specialtyListEl.removeChild(specialtyListEl.firstChild);
      }
      
      // Show/hide empty message
      if (specialtyServices.length === 0) {
        emptySpecialtyMessageEl.style.display = 'block';
        return;
      } else {
        emptySpecialtyMessageEl.style.display = 'none';
      }
      
      // Add each service to the list
      specialtyServices.forEach(service => {
        const serviceItem = document.createElement('div');
        serviceItem.className = 'specialty-item';
        serviceItem.dataset.id = service.id;
        
        const isHourly = (service.type !== 'prep' && service.type !== 'resolume' && service.type !== 'surface');
        const rate = RATES.specialty[service.type];
        const total = rate * service.amount;
        
        serviceItem.innerHTML = `
          <div class="specialty-item-details">
            <div class="specialty-item-title">${getSpecName(service.type)}</div>
            <div class="specialty-item-amount">
              ${service.amount} ${isHourly ? 'Hour' : 'Day'}${service.amount > 1 ? 's' : ''} Ã— $${rate}/${isHourly ? 'hr' : 'day'} = ${formatCurrency(total)}
            </div>
          </div>
          <div class="specialty-remove" data-id="${service.id}">
            <i class="fas fa-times"></i>
          </div>
        `;
        
        specialtyListEl.appendChild(serviceItem);
      });
      
      // Add event listeners to remove buttons
      document.querySelectorAll('.specialty-remove').forEach(btn => {
        btn.addEventListener('click', function() {
          const serviceId = parseInt(this.dataset.id);
          removeSpecialtyService(serviceId);
        });
      });
    }
    
    function removeSpecialtyService(serviceId) {
      specialtyServices = specialtyServices.filter(service => service.id !== serviceId);
      refreshSpecialtyList();
    }
    
    // Toggle travel days row
    includeTravelEl.addEventListener('change', function() {
      travelDaysRowEl.style.display = this.checked ? 'block' : 'none';
      if (!this.checked) {
        travelDaysEl.value = 0;
      } else {
        travelDaysEl.value = 1;
      }
    });
    
    // Calculate quote
    calculateBtnEl.addEventListener('click', () => {
      // Show loading indicator
      loadingIndicatorEl.style.display = 'flex';
      quoteSectionEl.style.display = 'none';
      invoiceSectionEl.style.display = 'none';
      
      // Simulate a slight delay for effect
      setTimeout(() => {
        calculateQuote();
        // Hide loading indicator
        loadingIndicatorEl.style.display = 'none';
        // Show quote section
        quoteSectionEl.style.display = 'block';
      }, 600);
    });
    
    // Reset form
    resetBtnEl.addEventListener('click', () => {
      // Reset all form fields
      document.querySelector('.form-section').reset();
      
      // Reset display states
      customDaysRowEl.style.display = 'none';
      travelDaysRowEl.style.display = 'none';
      quoteSectionEl.style.display = 'none';
      invoiceSectionEl.style.display = 'none';
      
      // Reset values that might not be caught by form reset
      customDaysEl.value = 1;
      travelDaysEl.value = 0;
      additionalHoursEl.value = 0;
      
      // Clear specialty services
      specialtyServices = [];
      refreshSpecialtyList();
      
      // Reset global variables
      quoteTotal = 0;
      depositAmount = 0;
      depositPercentage = 0;
    });
    
    function calculateQuote() {
      const svc = serviceTypeEl.value;
      const dur = durationTypeEl.value;
      const days = dur === 'custom' ? parseInt(customDaysEl.value) || 1 : 0;
      const ot = parseInt(additionalHoursEl.value) || 0;
      const cli = clientTypeEl.value;
      const includeTravel = includeTravelEl.checked;
      const travelDays = includeTravel ? parseInt(travelDaysEl.value) || 0 : 0;
      
      // Client and project info
      const clientName = clientNameEl.value.trim();
      const projectName = projectNameEl.value.trim();
      const projectLocation = projectLocationEl.value.trim();
      
      if (clientName) {
        quoteClientDisplayEl.textContent = clientName;
        quoteClientDisplayEl.style.display = 'inline-block';
      } else {
        quoteClientDisplayEl.style.display = 'none';
      }
      
      if (projectName) {
        let projectText = projectName;
        if (projectLocation) {
          projectText += ` (${projectLocation})`;
        }
        quoteProjectDisplayEl.textContent = projectText;
        quoteProjectDisplayEl.style.display = 'inline-block';
      } else {
        quoteProjectDisplayEl.style.display = 'none';
      }
      
      // Date formatting
      const now = new Date();
      const dateOptions = { year: 'numeric', month: 'long', day: 'numeric' };
      const formattedDate = now.toLocaleDateString('en-US', dateOptions);
      quoteDateEl.textContent = formattedDate;
      
      let total = 0;
      const rows = [];
      const notes = [];
      
      // Base rate
      if (dur === 'full' || dur === 'half') {
        const r = RATES[svc][dur];
        rows.push([
          getSvcName(svc),
          dur === 'full' ? 'Full Day (10h)' : 'Half Day (5h)',
          `$${r}`,
          r
        ]);
        total += r;
      } else if (['2day', '3day', '5day'].includes(dur)) {
        const r = RATES.packages[svc][dur];
        rows.push([
          getSvcName(svc),
          `${dur.replace('day', '')} Day Package`,
          `$${r}`,
          r
        ]);
        total += r;
      } else {
        let base = RATES[svc].full * days;
        let disc = days >= 5 ? 0.15 : days >= 3 ? 0.10 : days >= 2 ? 0.05 : 0;
        if (disc > 0) {
          const amt = Math.round(base * (1 - disc));
          rows.push([
            getSvcName(svc),
            `${days} Day Custom (${disc * 100}% off)`,
            `$${Math.round(amt / days)}/day`,
            amt
          ]);
          total += amt;
        } else {
          rows.push([
            getSvcName(svc),
            `${days} Day(s)`,
            `$${RATES[svc].full}/day`,
            base
          ]);
          total += base;
        }
      }
      
      // Travel days
      if (travelDays > 0) {
        const r = RATES[svc].full;
        const amt = r * travelDays;
        rows.push([
          'Travel Days',
          `${travelDays} day(s)`,
          `$${r}/day`,
          amt
        ]);
        total += amt;
      }
      
      // Overtime
      if (ot > 0) {
        const r = RATES[svc].overtime;
        const amt = r * ot;
        rows.push([
          'Overtime',
          `${ot}h`,
          `$${r}/h`,
          amt
        ]);
        total += amt;
      }
      
      // Multiple Specialty Services
      specialtyServices.forEach(service => {
        const isHourly = (service.type !== 'prep' && service.type !== 'resolume' && service.type !== 'surface');
        const r = RATES.specialty[service.type];
        const amt = r * service.amount;
        const details = `${service.amount} ${isHourly ? 'Hour' : 'Day'}${service.amount > 1 ? 's' : ''}`;
        
        rows.push([
          getSpecName(service.type),
          details,
          `$${r}/${isHourly ? 'h' : 'day'}`,
          amt
        ]);
        total += amt;
      });
      
      // Client Discount
      if (cli !== 'regular') {
        const pct = RATES.discounts[cli];
        const amt = Math.round(total * pct);
        rows.push([
          'Client Discount',
          `${getClientName(cli)}`,
          `-${pct * 100}%`,
          -amt
        ]);
        total -= amt;
      }
      
      // Calculate deposit percentage based on client type
      depositPercentage = RATES.depositRates[cli];
      
      // Calculate deposit amount
      depositAmount = Math.round(total * depositPercentage);
      
      // Notes
      notes.push(`Deposit: ${depositPercentage * 100}% (${formatCurrency(depositAmount)}) due on booking.`);
      notes.push('Includes up to 10 hours per day.');
      
      if (cli === 'partner5' || cli === 'partner8') {
        notes.push('Partner status requires meeting monthly booking thresholds and resets at the beginning of each month.');
      }
      
      if (travelDays > 0) {
        notes.push('Travel days are billed at the full day rate.');
      } else {
        notes.push('Travel and per diem may apply for events requiring overnight stays.');
      }
      
      notes.push('Cancellation: 50% fee if within 7 days, 25% fee if within 14 days.');
      notes.push('All rates are for labor only. Equipment available through partner vendors.');
      
      // Calculate valid until date (2 weeks from now)
      const validUntil = new Date(now);
      validUntil.setDate(validUntil.getDate() + 14);
      const validUntilFormatted = validUntil.toLocaleDateString('en-US', dateOptions);
      
      // Dates
      rows.unshift(['Quote Valid Until', validUntilFormatted, '', '']);
      rows.unshift(['Quote Date', formattedDate, '', '']);
      rows.push(['TOTAL', '', '', total]);
      
      // Store the final total
      quoteTotal = total;
      
      // Render
      quoteBodyEl.innerHTML = '';
      rows.forEach(r => {
        const tr = document.createElement('tr');
        r.forEach((cell, i) => {
          const td = document.createElement('td');
          td.innerHTML = i === 3 && typeof cell === 'number' ? formatCurrency(cell) : cell;
          tr.appendChild(td);
        });
        if (r[0] === 'TOTAL') tr.classList.add('total-row');
        quoteBodyEl.appendChild(tr);
      });
      
      quoteNotesEl.innerHTML = notes.map(n => `â€¢ ${n}`).join('<br>');
    }
    
    // Convert to invoice
    generateInvoiceEl.addEventListener('click', () => {
      // Build invoice number with current date format YYYYMMDD-XXX
      const now = new Date();
      const dateStr = now.getFullYear() + 
                      (now.getMonth() + 1).toString().padStart(2, '0') + 
                      now.getDate().toString().padStart(2, '0');
      
      const defaultInvoiceNum = `INV-${dateStr}-001`;
      
      // Create a modal-like prompt for invoice details
      const invoiceNum = prompt('Enter Invoice Number:', defaultInvoiceNum) || defaultInvoiceNum;
      invoiceNumberEl.textContent = invoiceNum;
      
      // Ask about deposit payment
      const depositPaid = confirm(`Has the ${depositPercentage * 100}% deposit (${formatCurrency(depositAmount)}) been paid?`);
      
      // Use client name from form or ask if empty
      const clientNameForInvoice = clientNameEl.value.trim() || prompt('Client Name:', '') || 'Client';
      invoiceClientEl.textContent = clientNameForInvoice;
      
      // Use project name from form
      invoiceProjectEl.textContent = projectNameEl.value.trim() || 'Technical Production Services';
      
      // Set the invoice date
      const dateOptions = { year: 'numeric', month: 'long', day: 'numeric' };
      const formattedDate = now.toLocaleDateString('en-US', dateOptions);
      invoiceDateEl.textContent = formattedDate;
      
      // Set the detailed date and time
      const timeOptions = { hour: '2-digit', minute: '2-digit' };
      const formattedDateTime = `Created on ${formattedDate} at ${now.toLocaleTimeString('en-US', timeOptions)}`;
      invoiceDateTimeEl.textContent = formattedDateTime;
      
      // Clone quote rows into invoice
      invoiceBodyEl.innerHTML = '';
      let subtotal = 0;
      
      Array.from(quoteBodyEl.children).forEach(row => {
        const service = row.cells[0].textContent;
        if (service === 'Quote Date' || service === 'Quote Valid Until') return;
        
        const clone = row.cloneNode(true);
        invoiceBodyEl.appendChild(clone);
        
        if (service !== 'TOTAL') {
          const amt = parseFloat(clone.cells[3].textContent.replace(/[^0-9.-]/g, '')) || 0;
          subtotal += amt;
        }
      });
      
      // Set summary amounts
      invoiceSubtotalEl.textContent = formatCurrency(subtotal);
      
      // Handle deposit display
      if (depositPaid) {
        depositRowEl.style.display = 'flex';
        invoiceDepositEl.textContent = `- ${formatCurrency(depositAmount)}`;
        invoiceTotalEl.textContent = formatCurrency(subtotal - depositAmount);
      } else {
        depositRowEl.style.display = 'none';
        invoiceTotalEl.textContent = formatCurrency(subtotal);
      }
      
      // Hide quote, show invoice
      quoteSectionEl.style.display = 'none';
      invoiceSectionEl.style.display = 'block';
    });
    
    // Back to quote
    backToQuoteEl.addEventListener('click', () => {
      invoiceSectionEl.style.display = 'none';
      quoteSectionEl.style.display = 'block';
    });
    
    // Print functionality
    printQuoteEl.addEventListener('click', () => printCurrentSection(quoteSectionEl, 'Quote'));
    printInvoiceEl.addEventListener('click', () => printCurrentSection(invoiceSectionEl, 'Invoice'));
    
    // Save as PDF (simulation)
    saveQuotePdfEl.addEventListener('click', () => {
      alert('In a production environment, this would generate a PDF of the quote. For now, please use the Print function and save as PDF.');
      printCurrentSection(quoteSectionEl, 'Quote');
    });
    
    saveInvoicePdfEl.addEventListener('click', () => {
      alert('In a production environment, this would generate a PDF of the invoice. For now, please use the Print function and save as PDF.');
      printCurrentSection(invoiceSectionEl, 'Invoice');
    });
    
    // Print helper function
    function printCurrentSection(sectionEl, title) {
      const content = sectionEl.innerHTML;
      const styles = document.querySelector('style').innerHTML;
      
      // Create a new window with just the section content
      const printWindow = window.open('', '_blank', 'width=800,height=600');
      printWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <title>Emmett's ${title}</title>
          <style>${styles}</style>
          <style>
            body {
              padding: 0;
              margin: 0;
              background: white;
            }
            .container {
              max-width: 100%;
              margin: 0;
              padding: 40px;
              box-shadow: none;
              background-color: white;
            }
            .result-section {
              display: block;
            }
            .btn-group {
              display: none;
            }
            @media print {
              body, html {
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
              }
              .container {
                padding: 20px;
              }
            }
          </style>
        </head>
        <body>
          <div class="container">
            <div class="result-section" style="display: block;">
              ${content}
            </div>
          </div>
        </body>
        </html>
      `);
      
      // Wait for content to load, then print
      printWindow.document.close();
      printWindow.onload = function() {
        setTimeout(() => {
          printWindow.focus();
          printWindow.print();
          // Close window after print or if print is canceled
          printWindow.addEventListener('afterprint', function() {
            printWindow.close();
          });
          setTimeout(() => {
            if (!printWindow.closed) {
              printWindow.close();
            }
          }, 5000); // Failsafe close after 5 seconds
        }, 300);
      };
    }
    
    // Light/Dark mode toggle
    darkModeToggleEl.addEventListener('click', toggleTheme);
    
    // Set default to dark mode, but check for saved preference
    if (localStorage.getItem('theme') === 'light') {
      document.body.classList.add('light-mode');
      darkModeToggleEl.innerHTML = '<i class="fas fa-moon"></i>';
    } else {
      // Default is dark mode (no class needed as it's the default now)
      darkModeToggleEl.innerHTML = '<i class="fas fa-sun"></i>';
      localStorage.setItem('theme', 'dark');
    }
    
    function toggleTheme() {
      if (document.body.classList.contains('light-mode')) {
        document.body.classList.remove('light-mode');
        darkModeToggleEl.innerHTML = '<i class="fas fa-sun"></i>';
        localStorage.setItem('theme', 'dark');
      } else {
        document.body.classList.add('light-mode');
        darkModeToggleEl.innerHTML = '<i class="fas fa-moon"></i>';
        localStorage.setItem('theme', 'light');
      }
    }
    
    // Helper functions
    function getSvcName(t) {
      return t === 'single' ? 'Single Role Technician'
           : t === 'multi' ? 'Multi-Role Technician'
           : 'Technical Director';
    }
    
    function getSpecName(s) {
      return s === 'prep' ? 'Pre-Production Day'
           : s === 'content' ? 'Content Development'
           : s === 'shader' ? 'Shader Development'
           : s === 'remote' ? 'Remote Consultation'
           : s === 'resolume' ? 'Resolume Laptop Rental'
           : s === 'surface' ? 'Surface Pro Rental'
           : '';
    }
    
    function getClientName(c) {
      return c === 'new' ? 'First-Time Client'
           : c === 'partner5' ? 'Partner (5-7 days/month)'
           : 'Partner (8+ days/month)';
    }
    
    // Format currency
    function formatCurrency(amount) {
      return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
        minimumFractionDigits: 0,
        maximumFractionDigits: 0
      }).format(amount);
    }
    
    // Prevent negative values in number inputs
    document.querySelectorAll('input[type="number"]').forEach(input => {
      input.addEventListener('change', function() {
        if (this.value < 0) this.value = 0;
        if (this.value === '') this.value = 0;
      });
    });
    
    // Form validation
    function validateForm() {
      let isValid = true;
      
      // Check duration type
      if (durationTypeEl.value === 'custom' && (customDaysEl.value <= 0 || customDaysEl.value === '')) {
        alert('Please enter a valid number of days.');
        isValid = false;
      }
      
      return isValid;
    }
    
    // Add validation before calculation
    calculateBtnEl.addEventListener('click', function(e) {
      if (!validateForm()) {
        e.preventDefault();
        return false;
      }
    });
    
    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      // Refresh specialty list to show empty message
      refreshSpecialtyList();
    });
  </script>
</body>
</html>
